"use strict";(()=>{var t={};t.id=48,t.ids=[48],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1467:t=>{t.exports=import("@vercel/kv")},8844:t=>{t.exports=import("ethers")},9796:t=>{t.exports=require("zlib")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,r){return r in e?e[r]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,r)):"function"==typeof e&&"default"===r?e:void 0}}})},8596:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{config:()=>f,default:()=>c,routeModule:()=>u});var n=r(1802),o=r(7153),s=r(6249),l=r(3923),i=t([l]);l=(i.then?(await i)():i)[0];let c=(0,s.l)(l,"default"),f=(0,s.l)(l,"config"),u=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/eth",pathname:"/api/eth",bundlePath:"",filename:""},userland:l});a()}catch(t){a(t)}})},3923:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{default:()=>J});var n=r(8844),o=r(9796),s=t([n]);n=(s.then?(await s)():s)[0];let W=process.env.RPC_URL||"https://carrot.megaeth.com/rpc",X=process.env.GAME_RESULTS_RPC_URL||process.env.MAINNET_RPC_URL||"https://mainnet.megaeth.com/rpc",Q=(process.env.CONTRACT_ADDRESS||"0x86b6f3856f086cd29462985f7bbff0d55d2b5d53").toLowerCase(),Y="0xae2afe4d192127e6617cfa638a94384b53facec1",tt=(process.env.GAME_RESULTS_CONTRACT||process.env.MAINNET_CONTRACT||"0x8aaf217a7a1534327234bd09474fc358e6e4d322").toLowerCase(),te="0xccc938abc01344413efee36b5d484cedd3bf4ce93b496e8021ba021fed9e2725",tr="0x95340ecf2fd1c1da827f4cf010d0726c65c2e05684a492c4eeaa6ac1b91babf0",ta=Math.floor(new Date("2025-11-15T00:00:00Z").getTime()/1e3),tn=Math.floor(new Date("2026-01-15T11:49:24Z").getTime()/1e3),to=[2e3,6e3,15e3],ts=(process.env.CACHE_NAMESPACE||`${Q}:${tr}`).toLowerCase();function l(t){return`${ts}:${t}`}let tl=new Map,ti=[];function i(t,e){let r=l(t);for(tl.has(r)||ti.push(r),tl.set(r,e);ti.length>120;){let t=ti.shift();void 0!==t&&tl.delete(t)}}let tc=!!(process.env.KV_REST_API_URL||process.env.UPSTASH_REDIS_REST_URL);function c(t){return`${ts}:day:${t}`}let tf=null;async function f(){return tc?(!process.env.KV_REST_API_URL&&process.env.UPSTASH_REDIS_REST_URL&&(process.env.KV_REST_API_URL=process.env.UPSTASH_REDIS_REST_URL),!process.env.KV_REST_API_TOKEN&&process.env.UPSTASH_REDIS_REST_TOKEN&&(process.env.KV_REST_API_TOKEN=process.env.UPSTASH_REDIS_REST_TOKEN),tf||(tf=(await Promise.resolve().then(r.bind(r,1467))).kv),tf):null}async function u(t){try{let e=await f();if(!e)return null;if(86400*t>=ta)return await e.get(c(t));{let[r,a]=await Promise.all([e.get(c(t)),e.get(`day:${t}`)]);return r||a}}catch{return null}}function g(t){let e={};for(let r of t){let t=(r.winningClasses||"").trim(),a=(r.losingClasses||"").trim();t&&(e[t]||(e[t]={wins:0,losses:0,total:0}),e[t].wins+=1,e[t].total+=1),a&&(e[a]||(e[a]={wins:0,losses:0,total:0}),e[a].losses+=1,e[a].total+=1)}return{byClass:e,lastUpdate:Date.now()}}async function h(t,e){try{let r=await f();if(!r)return;await r.set(c(t),e);let a=g(e.rows);await r.set(`${ts}:dayAgg:${t}`,a)}catch{}}let tu=new n.Interface(["event GameResultEvent(uint256 gameNumber, string gameId, string startedAt, string winningPlayer, string winningClasses, string losingPlayer, string losingClasses, string gameLength, string endReason, string gameType, string metadata)"]),tg=new n.Interface(["event GameResultEvent(uint256 gameNumber, string gameId, string startedAt, string winningPlayer, string winningClasses, string losingPlayer, string losingClasses, string gameLength, string endReason)"]);function m(t){return"0x"+t.toString(16)}function w(t){return new Promise(e=>setTimeout(e,t))}function d(t){let e=(t||"").trim(),r=e.indexOf("#");return -1===r?e:e.slice(0,r)}function y(t,e,r){let a=JSON.stringify(r),n=(0,o.gzipSync)(a);t.setHeader("Content-Type","application/json"),t.setHeader("Content-Encoding","gzip"),t.status(e).send(n)}async function p(t,e=W,r=6,a=800){let n=null;for(let o=0;o<r;o++)try{let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(429===r.status||503===r.status){n=Error("RPC HTTP "+r.status);let t=Number(r.headers.get("retry-after")),e=t>0?1e3*t:Math.round(a*Math.pow(1.8,o));await w(e);continue}if(!r.ok)throw Error("RPC HTTP "+r.status);let s=await r.json();if(Array.isArray(s)){let t=s.find(t=>t&&t.error);if(t)throw Error(t.error?.message||"RPC batch error")}else if(s&&s.error)throw Error(s.error?.message||"RPC error");return s}catch(t){n=t,await w(Math.round(a*Math.pow(1.6,o)))}throw n||Error("RPC failed after retries")}async function b(t,e=W){let r=await p({jsonrpc:"2.0",id:1,method:"eth_getBlockByNumber",params:[t,!1]},e),a=r?.result;if(!a)throw Error("Block not found");return{num:parseInt(a.number,16),ts:parseInt(a.timestamp,16)}}async function k(t,e=W){return b(m(t),e)}async function M(t=W){return b("earliest",t)}async function S(t=W){return b("latest",t)}async function x(t,e,r=W){let a=e?.earliest??await M(r),n=e?.latest??await S(r),o=Math.max(t,a.ts);if(o<=a.ts)return a.num;if(o>n.ts)return n.num;let s=a.num,l=n.num;for(;s<l;){let t=s+Math.floor((l-s)/2);(await k(t,r)).ts>=o?l=t:s=t+1}return s}async function P(t,e,r=W){let a=e?.earliest??await M(r),n=e?.latest??await S(r),o=Math.min(t,n.ts);if(o<a.ts)return a.num;if(o>=n.ts)return n.num;let s=a.num,l=n.num;for(;s<l;){let t=s+Math.floor((l-s+1)/2);(await k(t,r)).ts<=o?s=t:l=t-1}return s}async function R(t,e,r=Q,a=tr,n=W){if(e-t+1>1e5)throw Error(`Block range ${e-t+1} exceeds MAX_SPAN 100000`);let o=await p({jsonrpc:"2.0",id:1,method:"eth_getLogs",params:[{fromBlock:m(t),toBlock:m(e),address:r,topics:[a]}]},n);if(o?.error)throw Error(o.error.message||"RPC error");let s=o?.result||[],l=new Map;for(let t of s){let e=`${t.transactionHash}-${parseInt(t.logIndex,16)}`;l.set(e,t)}return Array.from(l.values())}async function A(t,e,r=Q,a=tr,n=W){let o=function(t,e){let r=[],a=t;for(;a<=e;){let t=Math.min(a+1e5-1,e);r.push({from:a,to:t}),a=t+1}return r}(t,e),s=[];for(let t=0;t<o.length;t+=3){let e=o.slice(t,t+3).map((e,o)=>p({jsonrpc:"2.0",id:1e3+t+o,method:"eth_getLogs",params:[{fromBlock:m(e.from),toBlock:m(e.to),address:r,topics:[a]}]},n));for(let t of(await Promise.all(e))){if(t?.error){console.error("getLogsChunked chunk error:",t.error);continue}s.push(...t?.result||[])}}let l=new Map;for(let t of s){let e=`${t.transactionHash}-${parseInt(t.logIndex,16)}`;l.set(e,t)}return Array.from(l.values())}function N(t){try{let[e,r,a,n,o,s,l,i,c,f,u]=tu.parseLog({topics:t.topics,data:t.data}).args;return{blockNumber:parseInt(t.blockNumber,16),txHash:t.transactionHash,logIndex:parseInt(t.logIndex,16),gameNumber:Number(e?.toString?.()??e),gameId:String(r),startedAt:String(a),winningPlayer:d(String(n)),winningClasses:String(o),losingPlayer:d(String(s)),losingClasses:String(l),gameLength:String(i),endReason:String(c),gameType:null!=f?String(f):void 0,metadata:null!=u?String(u):void 0,network:"megaeth-testnet-v2"}}catch{return null}}function C(t){try{let[e,r,a,n,o,s,l,i,c]=tg.parseLog({topics:t.topics,data:t.data}).args;return{blockNumber:parseInt(t.blockNumber,16),txHash:t.transactionHash,logIndex:parseInt(t.logIndex,16),gameNumber:Number(e?.toString?.()??e),gameId:String(r),startedAt:String(a),winningPlayer:d(String(n)),winningClasses:String(o),losingPlayer:d(String(s)),losingClasses:String(l),gameLength:String(i),endReason:String(c),network:"legacy"}}catch{return null}}function T(t,e=!1){return t.map(e?C:N).filter(Boolean)}function _(t){let e=new Map;for(let r of t){let t="number"!=typeof r.logIndex||isNaN(r.logIndex)?r.blockNumber:r.logIndex;e.set(`${r.txHash}:${t}`,r)}return Array.from(e.values())}function v(t,e){let r=new Map;for(let e of t)r.set(V(e),e);for(let t of e)r.set(V(t),t);return Array.from(r.values())}function I(t){return!!t?.rows?.some(t=>"megaeth-testnet-v2"===t.network)}function E(t){if(!t)return null;let e=/^([0-9]{4})-([0-9]{2})-([0-9]{2})[ T]([0-9]{2}):([0-9]{2}):([0-9]{2})(?:\s*(?:UTC|Z))?$/i.exec(t.trim());if(e){let t=Number(e[1]),r=Number(e[2])-1,a=Number(e[3]),n=Number(e[4]),o=Number(e[5]),s=Number(e[6]),l=Date.UTC(t,r,a,n,o,s);return Math.floor(l/1e3)}let r=t.replace(" ","T").replace(/\s*UTC$/i,"Z"),a=Date.parse(r);return isNaN(a)?null:Math.floor(a/1e3)}async function B(t,e){let r=Math.floor(t/86400),a=Math.floor(e/86400),n=[],o=[];for(let t=r;t<=a;t++){let e=tl.get(l(t));if(e&&e.rows.length>0){n.push(...e.rows);continue}let r=await u(t);if(r&&r.rows.length>0){i(t,r),n.push(...r.rows);continue}o.push(t)}return{rows:_(n).sort(K),missing:o}}async function U(t,e){if(!e.length)return;let r={fromBlock:Math.min(...e.map(t=>t.blockNumber)),toBlock:Math.max(...e.map(t=>t.blockNumber)),rows:e.sort(K),lastUpdate:Date.now()};i(t,r),await h(t,r)}async function $(t,e){for(let r=0;r<t.length;r+=3){let a=t.slice(r,r+3);await Promise.all(a.map(async t=>{try{let r=86400*t,a=r+86399;if(a<=tn){let n=await q(r,a,e);await h(t,n.entry),i(t,n.entry);return}let n=await z(r,a,!0);n.length>0&&(await U(t,n),console.log(`Backfilled mainnet day ${t} with ${n.length} games`))}catch(e){console.error(`Failed to backfill day ${t}:`,e?.message||String(e))}}))}}function L(t){return(t?.message||String(t||"")).toLowerCase().includes("logs for the requested block range are not yet available")}function D(t){let e=(t?.message||String(t||"")).toLowerCase();return e.includes("429")||e.includes("rate limited")}async function H(t,e,r,a,n){let o=Math.max(0,t.num-50),s=Math.max(0,o-120),l=[];try{l=await R(s,o,e,r,a)}catch{l=await A(s,o,e,r,a)}let i=_(T(l,n));return a===X?i.map(t=>({...t,network:"megaeth-mainnet"})):i}async function O(t){if(!t.length)return;let e=new Map;for(let r of t){let t=E(r.startedAt);if(null==t)continue;let a=Math.floor(t/86400);e.has(a)||e.set(a,[]),e.get(a).push(r)}for(let[t,r]of e.entries()){let e={fromBlock:Math.min(...r.map(t=>t.blockNumber)),toBlock:Math.max(...r.map(t=>t.blockNumber)),rows:r.sort(K),lastUpdate:Date.now()},a=function(t,e){if(!t)return e;if(!e)return t;let r=_([...t.rows,...e.rows]).sort(K);return{fromBlock:Math.min(t.fromBlock,e.fromBlock),toBlock:Math.max(t.toBlock,e.toBlock),rows:r,lastUpdate:Date.now()}}(tl.get(l(t))||null,e)||e;i(t,a),await h(t,a)}}function G(t,e){for(let r of to)setTimeout(()=>{e().catch(e=>console.error(`retry failed: ${t}`,e?.message||String(e)))},r)}function K(t,e){let r=E(t.startedAt),a=E(e.startedAt);return null!==r&&null!==a?a-r:null!==r?-1:null!==a?1:e.blockNumber-t.blockNumber}function j(t,e,r){return t.filter(t=>{let a=E(t.startedAt);return null==a||a>=e&&a<=r})}function V(t){return"number"!=typeof t.logIndex||isNaN(t.logIndex)?t.gameId?`gid:${t.gameId}`:`${t.txHash}:${t.blockNumber}`:`${t.txHash}:${t.logIndex}`}async function q(t,e,r){let a=Math.floor(t/86400),n=Math.max(t,r.earliest.ts),o=Math.min(Math.max(e,0),r.latest.ts),s=await x(n,r),l=await P(o,r);if(l<s)return{key:a,entry:{fromBlock:s,toBlock:l,rows:[],lastUpdate:Date.now()}};let i=t<ta,c=i?Y:Q,f=i?te:tr;if(t>=ta&&c!==Q){let t=await A(s,l,Q,tr),e=_(T(t,!1));return{key:a,entry:{fromBlock:s,toBlock:l,rows:e,lastUpdate:Date.now()}}}try{let t=await R(s,l,c,f),e=_(T(t,i));return{key:a,entry:{fromBlock:s,toBlock:l,rows:e,lastUpdate:Date.now()}}}catch{let t=await A(s,l,c,f),e=_(T(t,i));return{key:a,entry:{fromBlock:s,toBlock:l,rows:e,lastUpdate:Date.now()}}}}async function F(t,e,r,a){let n=t.toBlock+1,o=await P(Math.min(Math.max(r,0),a.latest.ts),a);if(o<n)return t;let s=[];try{s=await R(n,o)}catch{s=await A(n,o)}let l=s.map(N).filter(Boolean),i=[...t.rows,...l],c=new Map;for(let t of i){let e="number"!=typeof t.logIndex||isNaN(t.logIndex)?t.blockNumber:t.logIndex;c.set(`${t.txHash}:${e}`,t)}return{fromBlock:t.fromBlock,toBlock:o,rows:Array.from(c.values()),lastUpdate:Date.now()}}async function Z(t,e,r){let a;let n=Math.max(t,r.earliest.ts),o=Math.min(Math.max(e,n),r.latest.ts);if(o<n)return[];let s=n<ta,l=o>=ta,i=[];if(s){let t=await x(n,r),e=await P(Math.min(o,ta-1),r);e>=t&&i.push((async()=>{try{let r=await R(t,e,Y,te);return _(T(r,!0))}catch{let r=await A(t,e,Y,te);return _(T(r,!0))}})())}if(l){let t=await x(Math.max(n,ta),r),e=await P(o,r);e>=t&&i.push((async()=>{try{if("0x86b6f3856f086cd29462985f7bbff0d55d2b5d53"!==Q)throw Error(`Wrong contract address: ${Q}`);let r=await R(t,e,Q,tr),a=T(r,!1),n=_(a);return 0===n.length&&r.length>0&&console.error("Decoded logs but got 0 rows",{logsLength:r.length,fromBlock:t,toBlock:e}),n}catch(r){console.error("getLogsSingle failed, trying chunked",{error:r?.message||String(r),fromBlock:t,toBlock:e,contract:Q,topic0:tr});try{let r=await A(t,e,Q,tr),a=T(r,!1);return _(a)}catch(r){return console.error("getLogsChunked also failed",{error:r?.message||String(r),fromBlock:t,toBlock:e}),[]}}})())}if(0===i.length)return console.error("fetchRangeRowsDirect: No queries to execute",{startTs:t,endTs:e,needsLegacy:s,needsNew:l}),[];try{a=await Promise.all(i)}catch(r){return console.error("fetchRangeRowsDirect: Promise.all failed",{error:r?.message||String(r),startTs:t,endTs:e,queriesCount:i.length}),[]}let c=[];for(let t of a)Array.isArray(t)?c=v(c,t):console.error("fetchRangeRowsDirect: Invalid rows result",{rows:t});return c.sort(K),0===c.length&&e>=ta&&console.error("fetchRangeRowsDirect: Got 0 rows for new contract range",{startTs:t,endTs:e,needsNew:l,queriesCount:i.length,resultsLengths:a.map(t=>Array.isArray(t)?t.length:"invalid")}),c}async function z(t,e,r=!1){let a=await M(X),n=await S(X),o={earliest:a,latest:n},s=Math.max(t,a.ts),l=Math.min(e,n.ts);if(l<s)return[];let i=await x(s,o,X),c=await P(l,o,X);if(c<i)return[];let f=[];try{f=await R(i,c,tt,tr,X)}catch(t){console.log(`getLogsSingle failed for mainnet blocks ${i}-${c}, trying chunked:`,t?.message);try{f=await A(i,c,tt,tr,X)}catch(e){if(console.error("getLogsChunked also failed for mainnet:",e?.message),r&&(L(t)||L(e)||D(t)||D(e)))return(await H(n,tt,tr,X,!1)).sort(K);return[]}}return _(T(f,!1)).map(t=>({...t,network:"megaeth-mainnet"})).sort(K)}async function J(t,e){try{let{startTs:r,endTs:a,rebuildDay:n,wantAgg:o,clearCache:s,live:m,cacheOnly:w}=t.body||{};if("number"==typeof n&&n>=0){let t=await M(),r=await S(),a=86400*n,o=await q(a,a+86399,{earliest:t,latest:r});return i(o.key,o.entry),await h(o.key,o.entry),y(e,200,{ok:!0,rebuilt:o.key,fromBlock:o.entry.fromBlock,toBlock:o.entry.toBlock,rows:o.entry.rows.length})}let d=await M(),p=await S(),b={earliest:d,latest:p},k="number"==typeof r&&r>0?r:d.ts,C=!("number"==typeof a&&a>0),T="number"==typeof a&&a>0?a:p.ts,_=p.ts;try{let t=await S(X);_=Math.max(_,t.ts),"number"==typeof a&&a>0||(T=Math.max(T,t.ts))}catch{}if(T>_&&(T=_),T<k)return y(e,200,{ok:!0,rows:[]});let U=[],J=null,Y=Math.min(T,tn),te=Math.max(k,tn+1),to=T>tn;if(w){let t=await B(k,T);if(U=t.rows,t.missing.length>0&&(J=`Cached data missing for ${t.missing.length} day(s). Use Fetch latest to refresh.`),t.missing.length>0){let e=Math.floor(b.latest.ts/86400),r=t.missing.filter(t=>t<e);r.length>0&&setTimeout(()=>{$(r,b).catch(t=>{console.error("backfillMissingDays failed",t?.message||String(t))})},0)}let r=j(U,k,T).sort(K);if(o){let t=g(r);return y(e,200,{ok:!0,rows:r,aggByClass:t.byClass,aggLastUpdate:t.lastUpdate,warning:J})}return y(e,200,{ok:!0,rows:r,warning:J})}if(s){console.log("Clearing cache and fetching fresh data",{sTs:k,eTs:T});let t=Math.floor(k/86400),e=Math.floor(T/86400);for(let r=t;r<=e;r++){let t=l(r);tl.delete(t);try{let t=await f();t&&await t.del(c(r))}catch(t){console.error("Failed to clear KV cache for day",r,t)}}if(Y>=k)try{U=await Z(k,Y,b)}catch(t){J="RPC rate limited. Showing cached data; try again later for latest games.",console.error("fetchRangeRowsDirect failed (clearCache)",t?.message||String(t))}let r=new Map;for(let t of U){let e=E(t.startedAt);if(e){let a=Math.floor(e/86400);r.has(a)||r.set(a,[]),r.get(a).push(t)}}for(let[t,e]of r){let r={fromBlock:Math.min(...e.map(t=>t.blockNumber)),toBlock:Math.max(...e.map(t=>t.blockNumber)),rows:e.sort(K),lastUpdate:Date.now()};i(t,r),await h(t,r)}}else if(tc){let t=Math.min(Y,ta-1),e=Math.max(k,ta);if(Y>=k&&k<ta&&t>=k){let e=Math.floor(k/86400),r=Math.floor(t/86400),a=Math.floor(p.ts/86400),n=Math.floor(ta/86400),o=[];for(let a=e;a<=r;a++){if(a>=n)continue;let e=86400*a,r=e+86399;o.push({key:a,start:Math.max(e,k),end:Math.min(r,t)})}for(let t=0;t<o.length;t+=10){let e=o.slice(t,t+10).map(async t=>{let e=t.key<a,r=86400*t.key,n=r+86399,o=r>=ta,s=o?r:t.start,c=o?n:t.end;if(o&&e){let e=tl.get(l(t.key));if(e&&I(e)&&e.rows.length>0){U.push(...e.rows);return}let r=await u(t.key);if(r&&I(r)&&r.rows.length>0){i(t.key,r),U.push(...r.rows);return}let a=await x(s,b),n=await P(c,b);if(n<a)return;let o=[];try{o=await R(a,n)}catch{o=await A(a,n)}let f=o.map(N).filter(Boolean),g=new Map;for(let t of f){let e="number"!=typeof t.logIndex||isNaN(t.logIndex)?t.blockNumber:t.logIndex;g.set(`${t.txHash}:${e}`,t)}let m=Array.from(g.values()),w={fromBlock:a,toBlock:n,rows:m,lastUpdate:Date.now()};m.length>0&&(i(t.key,w),await h(t.key,w)),U.push(...m);return}let f=tl.get(l(t.key));if(f){if(e){U.push(...f.rows);return}{let e=await F(f,t.start,t.end,b);i(t.key,e),await h(t.key,e),U.push(...e.rows);return}}let g=await u(t.key);if(g){if(e){i(t.key,g),U.push(...g.rows);return}{let e=await F(g,t.start,t.end,b);i(t.key,e),await h(t.key,e),U.push(...e.rows);return}}let m=await q(s,c,b);i(m.key,m.entry),await h(m.key,m.entry),U.push(...m.entry.rows)});await Promise.all(e)}}if(Y>=ta){let t=Math.floor(p.ts/86400),r=Math.min(Y,86400*t-1);if(r>=e){let t=Math.floor(e/86400),a=Math.floor(r/86400),n=Math.min(5,a-t+1);for(let o=0;o<=a-t;o+=n){let s=[];for(let c=0;c<n&&t+o+c<=a;c++){let a=t+o+c,n=86400*a,f=n+86399,g=Math.max(n,e),m=Math.min(f,r);s.push((async()=>{let t=tl.get(l(a));if(t&&I(t)&&t.rows.length>0)return t.rows;let e=await u(a);if(e&&I(e)&&e.rows.length>0)return i(a,e),e.rows;try{let t=await Z(g,m,b);if(t.length>0){let e,r;e=Math.min(...t.map(t=>t.blockNumber)),r=Math.max(...t.map(t=>t.blockNumber));let n={fromBlock:e,toBlock:r,rows:t,lastUpdate:Date.now()};i(a,n),await h(a,n)}return t}catch(t){return console.error(`Failed to fetch day ${a}`,{error:t?.message||String(t),dayStart:g,dayEnd:m}),[]}})())}for(let t of(await Promise.all(s)))U=v(U,t)}}}}else if(console.log("Fetching directly without cache (no KV)",{sTs:k,eTs:T}),Y>=k)try{U=await Z(k,Y,b)}catch(t){J="RPC rate limited. Showing cached data; try again later for latest games.",console.error("fetchRangeRowsDirect failed (no KV)",t?.message||String(t))}if(!1!==m&&Y>=k){let t=Math.floor(p.ts/86400);if(Math.floor(Y/86400)>=t){let e=Math.max(k,86400*t,Y-600);if(e<=Y)try{let t=await Z(e,Y,b);U=v(U,t)}catch(r){console.error("fetchRangeRowsDirect failed (live)",r?.message||String(r));let t=[];if(L(r)||D(r))try{t=await H(b.latest,Q,tr,W,!1),U=v(U,t),await O(t)}catch{}0===t.length&&(J="RPC rate limited. Showing cached data; try again later for latest games."),G("legacy-live",async()=>{try{let t=await Z(e,Y,b);await O(t)}catch(t){if(L(t)||D(t)){let t=await H(b.latest,Q,tr,W,!1);await O(t)}else throw t}})}}}if(!1!==m&&to)try{let t=T,e=86400*Math.floor(b.latest.ts/86400),r=m&&k>=e,a=r?k:C?Math.max(te,t-600):te;if(C&&!r&&te<a-1){let t=await z(te,a-1,!1);U=v(U,t),await O(t)}let n=await z(a,t,C&&!r);U=v(U,n),await O(n)}catch(e){console.error("fetchRangeRowsMainnet failed",e?.message||String(e));let t=[];if(L(e)||D(e))try{let e=await S(X);t=await H(e,tt,tr,X,!1),U=v(U,t),await O(t)}catch{}0===t.length&&(J="RPC rate limited. Showing cached data; try again later for latest games."),G("mainnet-live",async()=>{let t=T,e=86400*Math.floor(b.latest.ts/86400),r=m&&k>=e,a=r?k:C?Math.max(te,t-600):te;C&&!r&&te<a-1&&await z(te,a-1,!1),await z(a,t,C&&!r)})}U.sort(K);let ts=j(U,k,T),ti=new Map;for(let t of ts)ti.set(V(t),t);let tf=Array.from(ti.values());if(tf.sort(K),o){let t=g(tf);return y(e,200,{ok:!0,rows:tf,aggByClass:t.byClass,aggLastUpdate:t.lastUpdate,warning:J})}y(e,200,{ok:!0,rows:tf,warning:J})}catch(t){y(e,200,{ok:!1,error:t?.message||String(t)})}}a()}catch(t){a(t)}})},7153:(t,e)=>{var r;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return r}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(t,e,r)=>{t.exports=r(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var r=e(e.s=8596);module.exports=r})();